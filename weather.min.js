function CONFIG(){}function EventHandler(t,e,a){this.type=t||null,this.listener=e||null,this.listenerSource=a||null}function DateDiff(t,e){this.msDag=864e5,this.msTimme=36e5,this.msMinut=6e4,this.totalMillisecondsDiff=e-t,this.totalMilliseconds=Math.abs(this.totalMillisecondsDiff);var a=this.totalMilliseconds;this.dagar=Math.floor(a/this.msDag),this.dagar>0&&(a-=this.dagar*this.msDag),this.timmar=Math.floor(a/this.msTimme),this.timmar>0&&(a-=this.timmar*this.msTimme),this.minuter=Math.floor(a/this.msMinut),this.minuter>0&&(a-=this.minuter*this.msMinut)}function UIFactory(){}function GooglePlaceAPI(){console.log("Place API"),google.maps?this.geocoder=new google.maps.Geocoder:(console.log("VARNING!!! Google Maps API INTE LADDAT"),this.geocoder=!1)}function GooglePlaceData(t,e,a,s,i){this.callback=s||null,this.source=i||null,this._data=a,this.lat=t,this["long"]=e,this.land=null,this.lan=null,this.stad=null,this.del=null,this.lokal=null,this.vag=null,this._process()}function GoogleMapAPI(t, e, a){this.lat=t,this["long"]=e,this.zoom=a,this._longPressTimeoutDuration=CONFIG.GoogleMapLongPressTimeoutDuration,this._longPressStarted=!1,this.map=null,this.marker=null,this.eventHandlers=[]}function GoogleMapUI(t, e, a){var s=e||60.866556,i=a||15.456375,n=6;this.container=t,this.mapWrapper=null,this.listener=null,this.listenerSource=null;this.mapAPI=new GoogleMapAPI(s,i,n),this.mapWrapper=document.createElement("div"),$(this.mapWrapper).attr("id","map-wrapper");var r=document.createElement("div");$(r).attr("id","map-button-wrapper"),$(r).addClass("sidepanel-button"),this.button=document.createElement("a"),$(this.button).attr("id","map-button"),$(this.button).text(" "),r.appendChild(this.button),this.container.appendChild(this.mapWrapper),this.container.appendChild(r)}function GooglePlaceManager(){this.platsTitle=document.createElement("h2"),$(this.platsTitle).attr("id","plats-title");this.place=new GooglePlaceAPI,this.place.setOnChangeListener(this.onPlaceChange,this)}function SMHIRadarUI(t,e){function a(t){t.spritesBaseLoaded++,t.spritesBaseLoaded==t.spritesBase.length&&t.renderBase()}this.SMHIMapWidth=CONFIG.SMHIMapWidth,this.SMHIMapHeight=CONFIG.SMHIMapHeight,this.MapAspectratio=this.SMHIMapWidth/this.SMHIMapHeight,this.radarMapsNum=CONFIG.SMHIMapsNum,this.radarAPI=new SMHIRadarAPI(this.radarMapsNum,this._start,this),this.frameDelay=CONFIG.SMHIMapsFrameDelay,this.frameIndex=0,this.framePauseNum=CONFIG.SMHIMapsPauseNum,this.framePauseIndex=0,this.container=t,this.baseMaps=[],this.baseMaps.push("gfx/radar_basemap.jpg"),this.spritesBase=[],this.spritesBaseLoaded=0,this.spritesRadar=[],this.spritesradarLoaded=0,this.radarWrapper=document.createElement("div"),$(this.radarWrapper).attr("id","radar-wrapper");var s=document.createElement("div");$(s).attr("id","radar-button-wrapper"),$(s).addClass("sidepanel-button"),this.button=document.createElement("a"),$(this.button).attr("id","radar-button"),$(this.button).text(" "),s.appendChild(this.button),this.container.appendChild(s),this.container.appendChild(this.radarWrapper),this.canvas=document.createElement("canvas"),this.canvas.id="radar",$(this.canvas).addClass("wr-item"),this.setDimension(this.calcDimension()),this.radarWrapper.appendChild(this.canvas);for(var i=0;i<this.baseMaps.length;i++){var n=new CanvasSprite(this.canvas.getContext("2d"),this.baseMaps[i],this.SMHIMapWidth,this.SMHIMapHeight);this.spritesBase.push(n),n.load(a,this)}}function SMHIRadarUIView(t,e,a,s){this.lat=t,this.zoom=e,this.x=a,this.y=s}function SMHIRadarAPI(t,e,a){this.radars=[],this.numLatestRadars=t,this.listener=e||null,this.listenerSource=a||null}function SMHIRadarMap(t,e){this.time=t,this.url=e}function CanvasSprite(t,e,a,s){this.context=t,this.url=e,this.width=a,this.height=s,this.img=null,this.loaded=!1}function HeaderUI(t){this.container=t;var e=document.createElement("h2");$(e).attr("id","plats");var a=document.createElement("span");$(a).attr("id","plats-namn"),$(a).text("Ingen plats vald..."),e.appendChild(a),this.container.appendChild(e)}function FooterUI(t){this.pageRead=new Date,this.forecastApprovedDateobject=null;var e=t,a=document.createElement("nav"),s=document.createElement("a");$(s).addClass("active"),$(s).text("Dag"),$(s).attr("href","#"),$(s).attr("data-toggles","day"),$(a).append(s);var i=document.createElement("a");$(i).text("Lista"),$(i).attr("href","#"),$(i).attr("data-toggles","list"),$(a).append(i);var n=document.createElement("div");$(n).attr("id","footer-body");var r='Sidan uppdateras: <span id="tid-sida">alldeles nyss</span> | Prognosen uppdaterades: <span id="tid-prognos">ingen prognos än</span>';n.innerHTML=r,$(e).append(a),$(e).append(i)}function WeatherIcon(t, e){return this.originSize=80,this._data=e,this.height=t||this.originSize,this.scale=this.height/this.originSize,this.width=this.height*this.scale,this.canvas=document.createElement("canvas"),this.canvas.id="weaher-icon-"+this.height+"-"+this._data.id,this.canvas.width=this.width,this.canvas.height=this.height,this.canvas.getContext("2d").scale(this.scale,this.scale),this.skySprite=null,this.nederbordSprite=null,this._addSky(!0),this.canvas}function SMHIForecastManager(t, e){this.api=new SMHIForecastAPI,this.api.setOnChangeListener(this.onDataChanged,this),this.ui=new SMHIForecastUI(t,e),this.days=[],this.loadingModalDOM=new UIDialogFactory.getWaitModalDOM("Laddar data från SMHI..."),this.googlePlatsData=null}function SMHIForecastAPI(){}function SMHIForecastAPIData(t,e){this.approvedTime=new Date(t),this.place=e||null,this.weatherItems=[],this.weatherDays=[]}function SMHIForecastAPIDataItem(t,e){this.datetimeRawUTC=t,this.dateobject=new Date(t),this.date=this.dateobject.getDateString(),this.time=this.dateobject.getTimeString();var a=this.date+this.time;this.id=a.replace(/\D/g,""),this.day=this.dateobject.getDayName(),this.temp=null,this.sikt=null,this.vindRiktning=null,this.vindHastighet=null,this.vindByarHastighet=null,this.nederbordTyp=null,this.nederbordMangd=null,this.nederbordMangdMax=null,this.nederbordMangdMin=null,this.molnighet=null,this.lufttryck=null,this.luftfuktighet=null,this.askSannolikhet=null,this.vind=null,this._data=[];for(var s=0; s<e.length; s++){var i=e[s];switch(i.name){case"t":this.temp=new SMHIForecastAPIDataParameter("Temperatur",Math.round(i.values[0]),i.unit),this._data.push(this.temp);break;case"vis":this.sikt=new SMHIForecastAPIDataParameter("Sikt",i.values[0],i.unit),this._data.push(this.sikt);break;case"wd":var n,r=i.values[0],o=[["N",337.5,22.5],["NE",22.5,67.5],["E",67.5,112.5],["SE",112.5,157.5],["S",157.5,202.5],["SW",202.5,247.5],["W",247.5,292.5],["NW",292.5,337.5]];for(var d in o)if(r>=d[1]&&r<d[2]){n=d[0];break}this.vindRiktning=new SMHIForecastAPIDataParameter("Vindriktning",r,i.unit,this._vindriktningToString(r)),this._data.push(this.vindRiktning);break;case"ws":this.vindHastighet=new SMHIForecastAPIDataParameter("Vindhastighet",i.values[0],i.unit,this._vindHastighetToString(i.values[0])),this._data.push(this.vindHastighet);break;case"gust":this.vindByarHastighet=new SMHIForecastAPIDataParameter("Byvindhastighet",i.values[0],i.unit,this._vindHastighetToString(i.values[0])),this._data.push(this.vindByarHastighet);break;case"hmsl":this.lufttryck=new SMHIForecastAPIDataParameter("Lufttryck",i.values[0],i.unit),this._data.push(this.lufttryck);break;case"r":this.luftfuktighet=new SMHIForecastAPIDataParameter("Luftfuktighet",i.values[0],i.unit),this._data.push(this.luftfuktighet);break;case"tstm":this.askSannolikhet=new SMHIForecastAPIDataParameter("Sannolikhet för åska",i.values[0],i.unit),this._data.push(this.askSannolikhet);break;case"tcc_mean":var l,h=i.values[0];switch(h){case 1:case 2:l="Mestadels klart";break;case 3:case 4:case 5:l="Halvklart";break;case 6:case 7:l="Nästan mulet";break;case 8:l="Mulet";break;default:h=0,l="Klart"}this.molnighet=new SMHIForecastAPIDataParameter("Molnighet",h,i.unit,l),this._data.push(this.molnighet);break;case"pcat":var l,c=i.values[0];switch(c){case 1:l="Snö";break;case 2:l="Snöblandat regn";break;case 3:l="Regn";break;case 4:l="Duggregn";break;case 5:l="Underkylt regn";break;case 6:l="Underkylt duggregn";break;default:l="",c=0}this.nederbordTyp=new SMHIForecastAPIDataParameter("Nederbörd",c,i.unit,l),this._data.push(this.nederbordTyp);break;case"pmean":this.nederbordMangd=new SMHIForecastAPIDataParameter("Nederbördsintensitet (medel)",i.values[0],"mm"),this._data.push(this.nederbordMangd);break;case"pmax":this.nederbordMangdMax=new SMHIForecastAPIDataParameter("Nederbördsintensitet (max)",i.values[0],i.unit),this._data.push(this.nederbordMangdMax);break;case"pmin":this.nederbordMangdMin=new SMHIForecastAPIDataParameter("Nederbördsintensitet (min)",i.values[0],i.unit),this._data.push(this.nederbordMangdMin)}}this.vind=this.vindHastighet.value+" "+this.vindHastighet.unit+" "+this._vindriktningToString(this.vindRiktning.value)+"("+this.vindRiktning.value+")"}function SMHIForecastAPIDataParameter(t, e, a, s){this.label=t,this.value=e,this.unit=a||"?",this.tolkning=s||""}function SMHIForecastDay(){this.daytimeHour=13,this.nighttimeHour=1,this.date=null,this.day=null,this.isWeekend=null,this.daytimeItem=null,this.nighttimeItem=null,this.maxTemp=null,this.minTemp=null,this.items=[]}function SMHIForecastUI(t, e){this.heroItemsContainer=t,this.dayItemsContainer=e,this.dayItems=[],this.dayBoxes=[],this.rightnowBox=null,this.laterBoxes=[],this._buildUI()}function UIWeatherPanel(t){var e=t||[];this.box=document.createElement("div"),$(this.box).addClass("weather-panel");for(var a=0; a<e.length; a++)$(this.box).addClass(e[a]);var s=document.createElement("header");this.title=document.createElement("h4"),$(this.title).addClass("title"),s.appendChild(this.title),this.subtitle=document.createElement("p"),$(this.subtitle).addClass("subtitle"),s.appendChild(this.subtitle),this.content=document.createElement("article"),this.box.appendChild(s),this.box.appendChild(this.content)}function SMHIForecastDayUI(t, e){this._data=null;var a=t||null,s=e||[];this.box=new UIWeatherPanel(s),a&&this.box.setId(a)}function SMHIForecastUIItemFactory(t){this._data=t,this.dayDOM,this.dateDOM,this.timeDOM,this.iconDOM,this.molnDescDOM,this.nederbordDescDOM,this.vindIconDOM,this.vindDescDOM}function SMHIForecastUIDataItemBig(t){this._data=t;var e=new SMHIForecastUIItemFactory(this._data),a=document.createElement("div");$(a).addClass("weather-item"),$(a).addClass("weather-item-big"),$(a).addClass("big");var s=e.createIconDOM(),i=e.createTempValueDOM("p"),n=e.createCloudcoverValueDOM("p"),r=e.createPrecipitationValueDOM("p"),o=e.createWindValueDOM("p");return a.appendChild(s),a.appendChild(i),a.appendChild(n),a.appendChild(r),a.appendChild(o),a}function SMHIForecastUIDataItemHero(t){this._data=t;var e=new SMHIForecastUIItemFactory(this._data),a=document.createElement("div");$(a).addClass("weather-item"),$(a).addClass("weather-item-hero"),$(a).addClass("hero");var s=e.createIconDOM(),i=e.createTempValueDOM("p"),n=e.createCloudcoverValueDOM("p"),r=e.createPrecipitationValueDOM("p"),o=e.createWindValueDOM("p");return a.appendChild(s),a.appendChild(i),a.appendChild(n),a.appendChild(r),a.appendChild(o),a}function SMHIForecastUINederbordinfo(t){var e=t||[];e.push("nederbordTyp-box"),this.box=new UIWeatherPanel(e),this.box.setId="nederbordTyp-box",this.box.setHeader("Nederbörd")}function responsify(){$(document).outerWidth(!0),$(document).outerHeight(!0)}function manageSizes(){console.log("manginging sizes");var t=radar.calcDimension();$("#radar-wrapper").width(t.width),radar.setDimension(t);var e=$("#map-button").width();$("#panel-map").css("left",-$("#map-wrapper").width()),$("#panel-radar").css("right",-$("#radar-wrapper").width()),$("#plats").css("padding-left",2*e)}function initCommonUIFunctions(){$("#map-button").click(function(t){$("#frame").hasClass("map-open")?uiCloseMap():uiOpenMap()}),$("#radar-button").click(function(t){$("#frame").hasClass("radar-open")?uiCloseRadar():uiOpenRadar()}),console.log("Init scrollera");var t=new IScroll("#panel-days",{scrollY:!1,scrollX:!0,scrollbars:!0,snap:"div",interactiveScrollbars:!0});console.log("Init days-scroller"),console.log(t.options)}function uiOpenMap(){console.log("öppnar map");var t=$("#map-wrapper").width(),e=$("#map-button").width();$("#frame").addClass("map-open"),$("#frame").addClass("sidepanel-open"),$("#panel-map").css("left",0),$("#panel-header").css("left",t),$("#panel-header").css("right",-t),$("#plats").css("padding-left",t+2*e)}function uiCloseMap(){console.log("stänger map");var t=$("#map-wrapper").width(),e=$("#map-button").width();$("#frame").removeClass("map-open"),$("#frame").removeClass("sidepanel-open"),$("#panel-map").css("left",-t),$("#panel-header").css("left",0),$("#panel-header").css("right",0),$("#plats").css("padding-left",2*e)}function uiOpenRadar(){console.log("öppnar radar"),radar.update();$("#radar-wrapper").width();$("#frame").addClass("radar-open"),$("#frame").addClass("sidepanel-open"),$("#panel-radar").css("right",0)}function uiCloseRadar(){console.log("stänger radar");var t=$("#radar-wrapper").width();$("#frame").removeClass("radar-open"),$("#frame").removeClass("sidepanel-open"),$("#panel-radar").css("right",-t)}function initWeatherUIFunctions(){$("#footer nav a").on("click",function(){$(this).hasClass("active")||($("#footer nav a").removeClass("active"),"day"==$(this).attr("data-toggles")?(console.log("switching to DAY view"),$(".tab-panel.list").css("opacity",0),$(".tab-panel.day").css("opacity",1),$(this).addClass("active")):(console.log("switching to LIST view"),$(".tab-panel.list").css("opacity",1),$(".tab-panel.day").css("opacity",0),$(this).addClass("active")))})}function UIDialogFactory(){}function Windarrow(t,e,a,s){var i=t||100,t=.8*i,n=e||.5*Math.PI;n+=.5*Math.PI,n+=Math.PI;var r=a;this.canvas=document.createElement("canvas"),$(this.canvas).addClass("windarrow"),this.canvas.width=i,this.canvas.height=i;for(var o=this.canvas.getContext("2d"),d=[[.5*t,0],[-.5*t,-.3*t],[-.5*t,.3*t]],l=0;l<d.length;l++){var h=d[l];d[l]=this._rotatePoint(-n,h[0],h[1])}return o.beginPath(),o.moveTo(d[0][0]+i/2,d[0][1]+i/2),o.lineTo(d[1][0]+i/2,d[1][1]+i/2),o.lineTo(d[2][0]+i/2,d[2][1]+i/2),o.lineTo(d[0][0]+i/2,d[0][1]+i/2),o.fillStyle=r,o.fill(),this.canvas}function apiloaded(){console.log("apiloaded"),plats=new GooglePlaceManager,plats.setOnChangeListener(platsChanged),map=new GoogleMapUI(document.getElementById("panel-map")),map.setOnChangeListener(mapChanged),map.init(),plats.findPlace(map),radar=new SMHIRadarUI(document.getElementById("panel-radar")),manageSizes(),initCommonUIFunctions()}function platsChanged(t){console.log("place changed"),forecast.update(t),header.setPlatsnamn(t.getString())}function mapChanged(t){console.log("map changed"),plats.setCoord(t.lat,t["long"])}function forecastChanged(t){console.log("forecastChanged"),footer.setForecastTime(t.approvedTime)}CONFIG.maxDays=10,CONFIG.coldLimit=0,CONFIG.warmLimit=20,CONFIG.colorWindArrow=[169,222,245],CONFIG.warnForByarAt=14,CONFIG.supressWindUnder=8,CONFIG.GoogleMapLongPressTimeoutDuration=500,CONFIG.SMHIMapWidth=471,CONFIG.SMHIMapHeight=887,CONFIG.SMHIMapsNum=20,CONFIG.SMHIMapsFrameDelay=150,CONFIG.SMHIMapsPauseNum=5,Date.prototype.getDayName=function(){switch(this.getDay()){case 1:return"Måndag";case 2:return"Tisdag";case 3:return"Onsdag";case 4:return"Torsdag";case 5:return"Fredag";case 6:return"Lördag";case 0:return"Söndag";default:return"okänd dag"}},Date.prototype.isWeekend=function(){return 6==this.getDay()||0==this.getDay()},Date.prototype.getDateString=function(){return this.toLocaleDateString()},Date.prototype.getTimeString=function(){return"kl."+this._addZero(this.getHours())+":"+this._addZero(this.getMinutes())},Date.prototype.diff=function(t){return new DateDiff(this,t)},Date.prototype._addZero=function(t){return 10>t?"0"+t:t},DateDiff.prototype.getDays=function(){return this.dagar},DateDiff.prototype.getHours=function(){return this.timmar},DateDiff.prototype.getMinutes=function(){return this.minuter},DateDiff.prototype.getTotalHours=function(){return Math.round(this.totalMilliseconds/this.msTimme)},DateDiff.prototype.getTotalMinutes=function(){return Math.round(this.totalMilliseconds/this.msMinut)},DateDiff.prototype.getTotalMinutesDiff=function(){return Math.round(this.totalMillisecondsDiff/this.msMinut)},DateDiff.prototype.getLongDurationString=function(){var t;return t=this.dagar>0?this.timmar<1?this.dagar+" dagar ":this.dagar+" dagar "+this.timmar+"h":this.timmar<1?" inom timmen":this.timmar+" timmar"},DateDiff.prototype.getShortDurationString=function(){var t;return t=this.timmar>0?this.timmar+" timmar "+this.minuter+" minuter":this.minuter+" minuter"},UIFactory.scrollify=function(t,e,a){console.log(e),console.log(a);var s="scroll-area";e&&(s+="-x"),a&&(s+="-y");new IScroll(t,{scrollX:e,scrollY:a,mouseWheel:!0,fadeScrollbars:!1,scrollbars:!0,snap:!1})},GooglePlaceAPI.prototype.setOnChangeListener=function(t,e){this.listener=t,this.listenerSource=e},GooglePlaceAPI.prototype.getPlaceFromCoord=function(t, e){var a={lat:t,lng:e},s=this;this.geocoder.geocode({location:a},function(a, i){if(i===google.maps.GeocoderStatus.OK)if(a[0]){var n=new GooglePlaceData(t,e,a);console.log("Plats "+n),s.listener&&s.listenerSource&&s.listener.call(s.listenerSource,n,s.listenerSource)}else console.log("Geocoder hittade inget platsnamn");else console.log("Geocoder fel uppstod: "+i)})},GooglePlaceAPI.prototype.getPlaceFromMap=function(t){},GooglePlaceData.prototype._process=function(){var t=this._data[0].address_components;this.vag=this._getAdressComponent(t,"route"),this.vag&&"unnamed road"==this.vag.toLowerCase()&&(this.vag=null),this.lokal=this._getAdressComponent(t,"locality"),this.del=this._getAdressComponent(t,"sublocality_level_1"),this.stad=this._getAdressComponent(t,"postal_town"),this.lan=this._getAdressComponent(t,"administrative_area_level_1"),this.land=this._getAdressComponent(t,"country")},GooglePlaceData.prototype._getAdressComponent=function(t, e){result=null;for(var a=0; a<t.length; a++)for(var s=t[a],i=0;i<s.types.length;i++)s.types[i]==e&&(result=s.short_name);return result},GooglePlaceData.prototype.getString=function(){var t="";return t=this.stad+" ("+this.del+")"},GooglePlaceData.prototype.toString=function(){return"<PLACE "+this.lokal+","+this.del+","+this.stad+","+this.lan+","+this.land+">"},GoogleMapAPI.prototype.addEventHandler=function(t,e,a){this.eventHandlers.push(new EventHandler(t,e,a))},GoogleMapAPI.prototype._execEventHandler=function(t,e){for(var a=e||null,s=0;s<this.eventHandlers.length;s++){var i=this.eventHandlers[s];i.type==t&&(console.log("found event "+t),i.listener&&i.listenerSource&&i.listener.call(i.listenerSource,a))}},GoogleMapAPI.prototype.init=function(t){this.map=new google.maps.Map(t,{zoom:this.zoom,center:{lat:this.lat,lng:this["long"]},streetViewControl:!1}),this.marker=new google.maps.Marker({position:{lat:this.lat,lng:this["long"]},map:this.map,title:"Långklicka på annan plats för att flytta"});var e=this;this.map.addListener("mousedown",function(t){console.log("mousedown"),e.lat=t.latLng.lat(),e["long"]=t.latLng.lng(),e._execEventHandler("mousedown",this);setTimeout(e._checkLongPressTimeout,e._longPressTimeoutDuration,e);e._longPressStarted=!0}),this.map.addListener("mouseup",function(t){console.log("click"),console.log("mouseup"),e._execEventHandler("mouseup",this),e._execEventHandler("click",this),e._longPressStarted=!1}),this.map.addListener("center_changed",function(){e._execEventHandler("pan",e),e._longPressStarted=!1}),this.map.addListener("bounds_changed",function(){e._execEventHandler("bounds_changed",e)})},GoogleMapAPI.prototype._checkLongPressTimeout=function(t){t._longPressStarted&&(console.log("long_mousedown TIMEOUT"),t._execEventHandler("long_mousedown",t),t._longPressStarted=!1)},GoogleMapAPI.prototype.setCoord=function(t,e){var a={lat:t,lng:e};this.marker.setPosition(a)},GoogleMapAPI.prototype.redraw=function(){google.maps.event.trigger(this.map,"resize"),this.map.panTo({lat:this.lat,lng:this["long"]})},GoogleMapUI.prototype.init=function(){this.mapAPI.init(this.mapWrapper);var t=this;this.mapAPI.addEventHandler("long_mousedown",function(e){e.setCoord(e.lat,e["long"]);var a={lat:e.lat,"long":e["long"]};t.listener&&(t.listenerSource?t.listener.call(t.listenerSource,a):t.listener(a))},this)},GoogleMapUI.prototype.setOnChangeListener=function(t,e){this.listener=t,this.listenerSource=e||null},GoogleMapUI.prototype.setCoord=function(t,e){this.mapAPI.setCoord(t,e)},GoogleMapUI.prototype.redraw=function(){this.mapAPI.redraw()},GooglePlaceManager.prototype.setOnChangeListener=function(t,e){this.listener=t,this.listenerSource=e},GooglePlaceManager.prototype.onPlaceChange=function(t,e){$(e.platsTitle).text(t.getString()),e.listener&&(e.listenerSource?e.listener.call(e.listenerSource,t,e.listenerSource):e.listener(t))},GooglePlaceManager.prototype.findPlace=function(t){var e=this,a=t||null;navigator.geolocation.getCurrentPosition(function(t){t?(e.setCoord(t.coords.latitude,t.coords.longitude),a&&a.setCoord(t.coords.latitude,t.coords.longitude)):alert("Din plats kunde inte automatiskt hittas. Välj en plats från kartan istället")})},GooglePlaceManager.prototype.setCoord=function(t,e){this._setCoord(t,e)},GooglePlaceManager.prototype._setCoord=function(t,e){this.place.getPlaceFromCoord(t,e)},SMHIRadarUI.prototype.update=function(){this.radarAPI.update()},SMHIRadarUI.prototype._start=function(t){function e(t){if(t.spritesradarLoaded++,t.spritesradarLoaded==t.spritesRadar.length){setInterval(t.nextRadar,t.frameDelay,t)}}for(var a=0;a<t.length;a++){var s=t[a],i=new CanvasSprite(this.canvas.getContext("2d"),s.url,this.SMHIMapWidth,this.SMHIMapHeight);i.load(e,this),this.spritesRadar.push(i)}},SMHIRadarUI.prototype.calcDimension=function(){var t={};return t.height=parseInt($(this.container).height()),t.width=parseInt(t.height*this.MapAspectratio),t},SMHIRadarUI.prototype.setDimension=function(t){this.canvas.width=t.width,this.canvas.height=t.height,$(this.canvas).height(t.height),$(this.canvas).width(t.width),this.canvas.getContext("2d").scale(t.height/this.SMHIMapHeight,t.height/this.SMHIMapHeight),this.render()},SMHIRadarUI.prototype.nextRadar=function(t){t.frameIndex<t.spritesRadar.length?(t.render(),t.frameIndex++):t.framePauseIndex<t.framePauseNum?t.framePauseIndex++:(t.frameIndex=0,t.framePauseIndex=0)},SMHIRadarUI.prototype.render=function(){this.renderBase(),this.spritesRadar.length>0&&this.spritesRadar[this.frameIndex].render(0,0)},SMHIRadarUI.prototype.renderBase=function(){for(var t=0;t<this.spritesBase.length;t++)this.spritesBase[t].render(0,0)},SMHIRadarAPI.prototype.update=function(){var t=new Date,e=t.getFullYear()+"/"+(t.getMonth()+1)+"/"+t.getDate(),a=this;$.get("http://opendata-download-radar.smhi.se/api/version/latest/area/sweden/product/comp/"+e,{format:"png"}).done(function(t){var e=a.numLatestRadars;t.files.length<a.numLatestRadars&&(e=t.files.length);for(var s=0;e>s;s++){var i=t.files[t.files.length-1-s].formats[0],n=new SMHIRadarMap(i.updated,i.link);a.radars.push(n)}a.radars.reverse(),a.listener&&(a.listenerSource?a.listener.call(a.listenerSource,a.radars):a.listener(a.radars))}).fail(function(){console.log("VARNING! Kunde inte h�mta radar-data fr�n SMHI")})},CanvasSprite.prototype.load=function(t,e){this.img=new Image,this.img.src=this.url,this.img.width=this.width,this.img.height=this.height,this._onLoad=t,this._onLoadSource=e;var a=this;this.img.onload=function(){a.loaded=!0,a._onLoad(a._onLoadSource)}},CanvasSprite.prototype.render=function(t,e){var a=t||0,s=e||0;this.loaded?this.context.drawImage(this.img,a,s,this.img.width,this.img.height,0,0,this.img.width,this.img.height):console.log("VARNING! Försöker använda "+this.url+" innan den laddats")},HeaderUI.prototype.setPlatsnamn=function(t){$("#plats-namn").text(t)},HeaderUI.prototype.addKarta=function(t){$("#kart-wrapper").append(t)},FooterUI.prototype.updateTimers=function(t){var e=new Date,a=t.pageRead.diff(e);if($("#tid-sida").text(a.getShortDurationString()+" sedan ("+t.pageRead.getTimeString()+")"),t.forecastApprovedDateobject){var s=t.pageRead.diff(t.forecastApprovedDateobject);$("#tid-prognos").text(s.getShortDurationString()+" sedan ("+t.forecastApprovedDateobject.getTimeString()+")")}else $("#tid-prognos").text("väntar på data...")},FooterUI.prototype.setForecastTime=function(t){this.forecastApprovedDateobject=t,this.updateTimers(this)},WeatherIcon.prototype._addSky=function(t){function e(t){t.skySprite.render(),t._addNederbord()}var a="gfx/";a+=t?"stor_":"liten_";var s="_dag",i=!0;if(!i)var s="_natt";switch(this._data.molnighet.value){case 1:case 2:a+="mestadels_klart";break;case 3:case 4:case 5:a+="halvklart";break;case 6:case 7:a+="halvklart";break;case 8:a+="mulet";break;default:a+="klart"}8!=this._data.molnighet&&(a+=s),a+=".png",this.skySprite=new CanvasSprite(this.canvas.getContext("2d"),a,this.originSize,this.originSize),this.skySprite.load(e,this)},WeatherIcon.prototype._addNederbord=function(t){function e(t){t.nederbordSprite&&t.nederbordSprite.render()}if(t=t||!0,this._data.nederbordTyp.value>0){var a="gfx/";switch(a+=t?"stor_inkludera_":"liten_inkludera_",this._data.nederbordTyp.value){case 1:a+="sno";break;case 2:a+="snoblandat";break;case 3:a+="regn";break;case 4:a+="duggregn";break;case 5:a+="regn";break;case 6:a+="duggregn";break;default:tolkning="",cat=0}a+=".png",this.nederbordSprite=new CanvasSprite(this.canvas.getContext("2d"),a,this.originSize,this.originSize),this.nederbordSprite.load(e,this)}else e(this)},SMHIForecastManager.prototype.setOnChangeListener=function(t, e){this.listener=t,this.listenerSource=e},SMHIForecastManager.prototype.update=function(t, e){var e=e||this,a=t||this.googlePlatsData;a&&(this.googlePlatsData=a,$(this.loadingModalDOM).modal(),e.api.update(this.googlePlatsData))},SMHIForecastManager.prototype.onDataChanged=function(t,e){console.log("Forecast Manager: data changed..."),this.loadingModalDOM&&$(this.loadingModalDOM).modal("hide"),e.listener&&(e.listenerSource?e.listener.call(e.listenerSource,t,e.listenerSource):e.listener(t)),this.ui.update(t),initWeatherUIFunctions(),responsify()},SMHIForecastAPI.prototype.setOnChangeListener=function(t,e){this.listener=t,this.listenerSource=e},SMHIForecastAPI.prototype.update=function(t){var e=t,a=e.lat.toFixed(4),s=e["long"].toFixed(4),i="http://opendata-download-metfcst.smhi.se/api/category/pmp2g/version/2/geotype/point/lon/"+s+"/lat/"+a+"/data.json",n=this;$.get(i).done(function(t){for(var a=new SMHIForecastAPIData(t.approvedTime,e),s=0;s<t.timeSeries.length;s++)a.addDataItem(t.timeSeries[s].validTime,t.timeSeries[s].parameters);a.process(),n.callback&&(n.source?n.source[n.callback](a,n.source):n.callback(a,n.source)),n.listener&&(n.listenerSource?n.listener.call(n.listenerSource,a,n.listenerSource):n.listener(a,n.listenerSource))}).fail(function(){console.log("VARNING! Kunde inte få forecats fråm SMHI")})},SMHIForecastAPIData.prototype.addDataItem=function(t,e){this.weatherItems.push(new SMHIForecastAPIDataItem(t,e))},SMHIForecastAPIData.prototype.process=function(){for(var t=[],e=0,a=0; a<this.weatherItems.length; a++){var s=this.weatherItems[a],i=s.dateobject.getDateString();if(i in t)t[i].push(s);else{if(!(e<CONFIG.maxDays))break;t[i]=[],e++}}for(dayIndex in t){var n=new SMHIForecastDay;n.addItems(t[dayIndex]),this.weatherDays.push(n)}},SMHIForecastAPIData.prototype.getClosestItem=function(t){var e=t||new Date,a=this.weatherItems.slice();return a.sort(function(t, a){return Math.abs(1-t.dateobject/e)-Math.abs(1-a.dateobject/e)}),a[0]},SMHIForecastAPIDataItem.prototype._vindriktningToString=function(t){var e=Math.round(t/45);return arr=["N","NO","O","SO","S","SV","V","NV"],arr[e%8]+"("+t+")"},SMHIForecastAPIDataItem.prototype._vindHastighetToString=function(t){var e="Vindstilla";return t>=.3&&(e="Svag vind"),t>=3.4&&(e="Måttlig vind"),t>=8&&(e="Frisk vind"),t>=13.9&&(e="Hård vind"),t>=24.5&&(e="Storm!"),t>=32.7&&(e="ORKAN!!!"),e},SMHIForecastAPIDataItem.prototype.toString=function(){for(var t="<DATA ["+this.date+"|"+this.time+"] ",e=0; e<this._data.length; e++){var a=this._data[e];t+=a.toString()+" "}return t+=">"},SMHIForecastAPIDataParameter.prototype.toString=function(){var t;return t=""!=this.tolkning?"("+this.tolkning+")":"",this.label+":"+this.value+this.unit+t},SMHIForecastDay.prototype._update=function(){if(this.items.length>0)for(this.date=this.items[0].dateobject.getDateString(),this.day=this.items[0].dateobject.getDayName(),this.isWeekend=this.items[0].dateobject.isWeekend(),this.daytimeItem=null,this.nighttimeItem=null,i=0; i<this.items.length; i++)this.items[i].dateobject.getHours()==this.daytimeHour&&(this.daytimeItem=this.items[i]),this.items[i].dateobject.getHours()==this.nighttimeHour&&(this.nighttimeItem=this.items[i])},SMHIForecastDay.prototype.addItem=function(t, e){var a=e||!0;this.items.push(t),a&&this._update()},SMHIForecastDay.prototype.addItems=function(t){for(var e=0; e<t.length; e++)this.addItem(t[e],!1);this._update()},SMHIForecastDay.prototype.clear=function(){this.items=[]},SMHIForecastUI.prototype._buildUI=function(){for(var t=0; t<CONFIG.maxDays; t++)this.dayBoxes[t]=new SMHIForecastDayUI("day-box-"+t,["day-box"]),this.dayItemsContainer.appendChild(this.dayBoxes[t].getDOM());this.rightnowBox=new SMHIForecastUINederbordinfo(["hero-box"]),this.heroItemsContainer.appendChild(this.rightnowBox.getDOM());for(var e=0; 4>e; e++)this.laterBoxes[e]=new UIWeatherPanel(["hero-box","hero-box-"+(e+1)]),this.laterBoxes[e].setId="hero-box-"+e,this.heroItemsContainer.appendChild(this.laterBoxes[e].getDOM())},SMHIForecastUI.prototype.update=function(t){console.log("Forecast UI Manager: update..."),this.rightnowBox.update(t);var e=t.getClosestItem(),a=new SMHIForecastUIDataItemHero(e),s=new Date;s.setHours(s.getHours()+2);var i=t.getClosestItem(s),n=new SMHIForecastUIDataItemHero(i);s=new Date,s.setHours(s.getHours()+6);var r=t.getClosestItem(s),o=new SMHIForecastUIDataItemHero(r);s=new Date,s.setHours(s.getHours()+12);var d=t.getClosestItem(s),l=new SMHIForecastUIDataItemHero(d),h=new Date,c=h.diff(e.dateobject);c.getTotalMinutesDiff()<0?nowTime=c.getTotalMinutesDiff()+" minuter":nowTime="+"+c.getTotalMinutesDiff()+" minuter";var p=h.diff(i.dateobject),u=h.diff(r.dateobject),m=h.diff(d.dateobject);this.laterBoxes[0].clear(),this.laterBoxes[0].append(a),this.laterBoxes[0].setHeader("Nu",nowTime),this.laterBoxes[1].clear(),this.laterBoxes[1].append(n),this.laterBoxes[1].setHeader("+"+p.getTotalHours()+" timmar",i.day+" "+i.time),this.laterBoxes[2].clear(),this.laterBoxes[2].append(o),this.laterBoxes[2].setHeader("+"+u.getTotalHours()+" timmar",r.day+" "+r.time),this.laterBoxes[3].clear(),this.laterBoxes[3].append(l),this.laterBoxes[3].setHeader("+"+m.getTotalHours()+" timmar",d.day+" "+d.time);for(day in t.weatherDays){var g=this.dayBoxes[day],I=t.weatherDays[day];g.update(I)}},UIWeatherPanel.prototype.setHeader=function(t,e){var a=t||null,s=e||null;$(this.title).text(a),$(this.subtitle).text(s)},UIWeatherPanel.prototype.addClass=function(t){$(this.box).addClass(t)},UIWeatherPanel.prototype.removeClass=function(t){$(this.box).removeClass(t)},UIWeatherPanel.prototype.setId=function(t){this.box.id=t},UIWeatherPanel.prototype.clear=function(t){this.content.innerHTML=""},UIWeatherPanel.prototype.append=function(t){this.content.appendChild(t)},UIWeatherPanel.prototype.getDOM=function(){return this.box},SMHIForecastDayUI.prototype.update=function(t){this._data=t,this.box.clear(),this.box.setHeader(this._data.day,this._data.date);var e=(this._data.date.replace(/\D+/g,""),"");if(this._data.items.length>0){var a=document.createElement("div");$(a).addClass("panel"),$(a).addClass("list"),e="list"}if(this._data.nighttimeItem){var s=document.createElement("div");$(s).addClass("panel"),$(s).addClass("night");var i=new SMHIForecastUIDataItemBig(this._data.nighttimeItem);s.appendChild(i),this.box.append(s),e="night"}if(this._data.daytimeItem){var n=document.createElement("div");$(n).addClass("panel"),$(n).addClass("day");var r=new SMHIForecastUIDataItemBig(this._data.daytimeItem);n.appendChild(r),
this.box.append(n),e="day"}switch(this._data.isWeekend?this.box.addClass("weekend"):this.box.removeClass("weekend"),e){case"list":$(a).addClass("active");break;case"day":$(n).addClass("active");break;case"night":$(s).addClass("active")}},SMHIForecastDayUI.prototype.getDOM=function(){return this.box.getDOM()},SMHIForecastUIItemFactory.prototype.getTdDOM=function(t){t=t||null;var e=document.createElement("tr");$(e).addClass("weather-item"),$(e).addClass("weather-item-list"),$(e).addClass("list"),t&&$(e).addClass(t);var a=this.createCommonValueDOM("td",this._data.time,"wr-time"),s=this.createCommonValueDOM("td",this._data.temp.value+"°","wr-temp"),i=this.createCommonValueDOM("td",this._data.molnighet.tolkning,"wr-vader-desc");return this._data.nederbordTyp.value>0&&(i.innerHTML+=" - "+this._data.nederbordTyp.tolkning),e.appendChild(a),e.appendChild(s),e.appendChild(i),e},SMHIForecastUIItemFactory.prototype.createTempValueDOM=function(t){var e=["temperature","weather-data"];return this._data.temp.value<CONFIG.coldLimit&&e.push("cold"),this._data.temp.value>CONFIG.warmLimit&&e.push("hot"),this.createCommonValueDOM(t,this._data.temp.value+"°",e)},SMHIForecastUIItemFactory.prototype.createCloudcoverValueDOM=function(t){return this.createCommonValueDOM(t,this._data.molnighet.tolkning,["cloudcover","weather-data"])},SMHIForecastUIItemFactory.prototype.createPrecipitationValueDOM=function(t){var e="",a=["precipitation","weather-data"];this._data.nederbordTyp.value>0?e=this._getNederbordMangdDesc(this._data.nederbordMangdMax.value,this._data.nederbordTyp.tolkning):(a.push("suppress"),e="Uppehåll");var s=this.createCommonValueDOM(t,e,a);return s},SMHIForecastUIItemFactory.prototype.createWindValueDOM=function(t){var e=document.createElement(t);$(e).addClass("weather-data"),$(e).addClass("wind");var a=this._data.vindHastighet.value/14;.05>a&&(a=.05),a>1&&(a=1);var s=document.createElement("span");$(s).addClass("wind-direction");var i="rgba("+CONFIG.colorWindArrow[0]+", "+CONFIG.colorWindArrow[1]+", "+CONFIG.colorWindArrow[2]+", "+a.toFixed(2)+")";s.appendChild(new Windarrow(15,this._data.vindRiktning.value*(Math.PI/180),i));var n=this.createCommonValueDOM("span",this._data.vindHastighet.tolkning,["wind-speed"]);this._data.vindHastighet.value<CONFIG.supressWindUnder&&$(n).addClass("suppress");var r=this.createCommonValueDOM("span",this._data.vindByarHastighet.tolkning+" i byar!",["wind-gustspeed"]);return $(r).addClass("warning"),r.innerHTML="<br>"+r.innerHTML,e.appendChild(s),e.appendChild(n),this._data.vindHastighet.tolkning!=this._data.vindByarHastighet.tolkning&&this._data.vindByarHastighet.value>CONFIG.warnForByarAt&&e.appendChild(r),e},SMHIForecastUIItemFactory.prototype.createIconDOM=function(t){var t=t||100,e=new WeatherIcon(t,this._data),a=document.createElement("div");return $(a).addClass("icon"),$(a).addClass("weather-data"),a.appendChild(e),a},SMHIForecastUIItemFactory.prototype.createCommonValueDOM=function(t, e, a){for(var s=a||[],i=document.createElement(t),n=0; n<s.length; n++)$(i).addClass(s[n]);return $(i).addClass("weather-data-value"),$(i).text(e),i},SMHIForecastUIItemFactory.prototype._getNederbordMangdDesc=function(t, e){var a="Lätt";return"snö"==e.toLowerCase()?(t>.2&&(a="Måttligt"),t>.6&&(a="Tätt")):(t>.5&&(a="Måttligt"),t>4&&(a="Starkt")),a+" "+e.toLowerCase()},SMHIForecastUINederbordinfo.prototype.update=function(t){this.box.clear();var e=new Date,a=t.getClosestItem(),s=a.nederbordTyp.value;if(s>0){for(var i=null,n=0; n<t.weatherItems.length; n++){var r=t.weatherItems[n];if(r.nederbordTyp.value!=s){i=r;break}}var o=document.createElement("div");$(o).addClass("weather-nederbord-end"),$(o).addClass("weather-item"),$(o).addClass("hero");var d=document.createElement("p");$(d).addClass("desc"),$(d).addClass("wr-value");var l=document.createElement("p");if($(l).addClass("time"),$(l).addClass("wr-value"),o.appendChild(d),o.appendChild(l),i){var h=e.diff(i.dateobject);$(d).text(a.nederbordTyp.tolkning+" slutar om"),$(l).text(h.getLongDurationString())}else $(d).text("Ser inget slut på "+s),$(l).text(":'(");this.box.append(o)}for(var c=null,n=0; n<t.weatherItems.length; n++){var r=t.weatherItems[n];if(r.nederbordTyp.value!=s&&r.nederbordTyp.value>0){c=r;break}}var p=document.createElement("div");$(p).addClass("weather-nederbord-next"),$(p).addClass("weather-item"),$(p).addClass("hero");var u=document.createElement("p");$(u).addClass("desc"),$(u).addClass("weather-data-value");var m=document.createElement("p");if($(m).addClass("time"),$(m).addClass("weather-data-value"),p.appendChild(u),p.appendChild(m),c){var h=e.diff(c.dateobject);$(u).text(c.nederbordTyp.tolkning+" om"),$(m).text(h.getLongDurationString())}else $(u).text("Ingen ny nederbörd på ett tag"),$(m).text(":)");this.box.append(p)},SMHIForecastUINederbordinfo.prototype.getDOM=function(){return this.box.getDOM()},$(window).on("resize",function(){manageSizes()}),UIDialogFactory.getErrorModalDOM=function(t){console.log("show error");var e=[this._getCloseButton()],a=UIDialogFactory._getDialogBaseDOM("error-modal","error","Ett fel har uppstått",t,e);return document.body.appendChild(a),a},UIDialogFactory.getWaitModalDOM=function(t){console.log("show waiting");var e=UIDialogFactory._getDialogBaseDOM("wait-modal","wait",t);return $(e).attr("data-backdrop","false"),document.body.appendChild(e),e},UIDialogFactory._getDialogBaseDOM=function(t,e,a,s,i){var n=i||[],r=s||null,o=document.createElement("div");$(o).attr("id",t),$(o).addClass("modal"),$(o).addClass(e),$(o).addClass("fade"),$(o).attr("role","dialog");var d=document.createElement("div");$(d).attr("class","modal-dialog"),o.appendChild(d);var l=document.createElement("button");$(l).attr("class","close"),$(l).attr("type","button"),$(l).attr("data-dismiss","modal"),$(l).html("&times;");var h=document.createElement("div");$(h).attr("class","modal-content"),d.appendChild(h);var c=document.createElement("div");if($(c).attr("class","modal-body"),$(c).html(a),r){var p=document.createElement("div");$(p).attr("class","modal-header"),h.appendChild(p);var u=document.createElement("h4");$(u).attr("class","modal-title"),$(u).text(r),p.appendChild(l),p.appendChild(u)}else c.appendChild(l);if(h.appendChild(c),n.length>0){var m=document.createElement("div");$(m).attr("class","modal-footer"),h.appendChild(m);for(var g=0;g<n.length;g++)m.appendChild(n[g])}return o},UIDialogFactory._getMessageBase=function(t,e,a){var s=document.createElement("div");$(s).attr("id",t),$(s).attr("class","modal fade"),$(s).attr("role","dialog");var i=document.createElement("div");$(i).attr("class","modal-dialog"),s.appendChild(i);var n=document.createElement("div");$(n).attr("class","modal-content"),i.appendChild(n);var r=document.createElement("div");$(r).attr("class","modal-header"),n.appendChild(r);var o=document.createElement("h4");$(o).attr("class","modal-title"),$(d).text(e);var d=document.createElement("button");$(d).attr("class","close"),$(d).attr("type","button"),$(d).attr("data-dismiss","modal"),$(d).html("&times;"),r.appendChild(d),r.appendChild(o);var l=document.createElement("div");$(l).attr("class","modal-body"),$(l).html(a),n.appendChild(l);var h=document.createElement("div");$(h).attr("class","modal-footer"),n.appendChild(h);var c=UIDialogFactory._getCloseButton();return h.appendChild(c),s},UIDialogFactory._getCloseButton=function(t){title=t="Stäng";var e=document.createElement("button");return $(e).attr("class","btn btn-default"),$(e).attr("type","button"),$(e).attr("data-dismiss","modal"),$(e).html(title),e},Windarrow.prototype._rotatePoint=function(t,e,a){return[e*Math.cos(t)-a*Math.sin(t),e*Math.sin(t)+a*Math.cos(t)]};var radar,forecast,plats,map,header,footer;$(document).ready(function(){console.log("document ready"),header=new HeaderUI(document.getElementById("panel-header")),footer=new FooterUI(document.getElementById("panel-footer")),forecast=new SMHIForecastManager(document.getElementById("panel-heroes"),document.getElementById("days-container")),forecast.setOnChangeListener(forecastChanged),footer.updateTimers(footer),setInterval(footer.updateTimers,1e4,footer),setInterval(function(){forecast.update()},6e5)});